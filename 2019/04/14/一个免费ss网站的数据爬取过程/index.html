<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>一个免费ss网站的数据爬取过程 | Hexo</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">一个免费ss网站的数据爬取过程</h1><a id="logo" href="/.">Hexo</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> Start</i></a><a href="/archives/"><i class="fa fa-archive"> Archiv</i></a><a href="/about/"><i class="fa fa-user"> Über</i></a><a href="/atom.xml"><i class="fa fa-rss"> RSS</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">一个免费ss网站的数据爬取过程</h1><div class="post-meta">Apr 14, 2019</div><div class="post-content"><!-- toc -->
<ul>
<li><a href="#引言">引言</a></li>
<li><a href="#爬虫整体概况">爬虫整体概况</a></li>
<li><a href="#主要功能方法">主要功能方法</a><ul>
<li><a href="#绕过ddos保护cloudflare">绕过DDOS保护（Cloudflare）</a></li>
<li><a href="#post中参数abc的解析">post中参数a,b,c的解析</a><ul>
<li><a href="#post中参数abc的解析-1">post中参数a,b,c的解析</a></li>
<li><a href="#post参数abc值的确定">post参数a,b,c值的确定</a></li>
<li><a href="#post参数c的值的加密">post参数c的值的加密</a></li>
</ul>
</li>
<li><a href="#aes加密数据解码">AES加密数据解码</a><ul>
<li><a href="#确定aes加密模式弃用">确定AES加密模式（弃用）</a></li>
<li><a href="#免判断加密模式并解密推荐">免判断加密模式并解密（推荐）</a></li>
<li><a href="#解码数据并测延时">解码数据并测延时</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#最后">最后</a><ul>
<li><a href="#相关资源">相关资源</a><ul>
<li><a href="#本文相关库">本文相关库</a></li>
<li><a href="#第三方开源库">第三方开源库</a></li>
<li><a href="#在线测试工具">在线测试工具</a></li>
<li><a href="#参考">参考</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- tocstop -->
<h1><span id="引言">引言</span></h1><p>偶然发现一个免费ss分享网站，本以为简单的url请求即可获取数据。但是没想到在网站的反爬机制很严格，这反而激起了我的好奇心。</p>
<p>不过对于爬虫经验技术来说，是一个很好的学习检验的机会。</p>
<h1><span id="爬虫整体概况">爬虫整体概况</span></h1><p>数据获取的核心是围绕2个<strong>http请求</strong>：</p>
<table>
<thead>
<tr>
<th style="text-align:center">方法</th>
<th style="text-align:center">地址</th>
<th style="text-align:center">参数</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">get</td>
<td style="text-align:center">url</td>
<td style="text-align:center">无</td>
<td>响应源码中有可用信息</td>
</tr>
<tr>
<td style="text-align:center">post</td>
<td style="text-align:center">url1</td>
<td style="text-align:center">a,b,c</td>
<td>返回加密数据文本</td>
</tr>
</tbody>
</table>
<p><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24pnzo80gj20pa0oywhi.jpg" alt></p>
<h1><span id="主要功能方法">主要功能方法</span></h1><h2><span id="绕过ddos保护cloudflare">绕过DDOS保护（Cloudflare）</span></h2><p>简单来讲cloudflare就是通过js验证访问是否来至真正的web浏览器。</p>
<p><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24q32f71mj20hi05zaag.jpg" alt></p>
<p>如上图所示，访问url 时候一般会进入5秒左右倒计时；请求状态码是503。<br>通过抓包可以看到503请求数秒后跳转一个类似“<a href="https://xxxxx/cdn-cgi/l/chk_jschl?s=xxx”的302请求，成功后即可跳转到期望页面。" target="_blank" rel="noopener">https://xxxxx/cdn-cgi/l/chk_jschl?s=xxx”的302请求，成功后即可跳转到期望页面。</a></p>
<p><strong>解决方法：</strong>使用任意一个第三方库：cloudflare-scrape 或者 <strong>cloudflare-scrape-js2py</strong><br>这2个库方法通用，安装cloudflare-scrape-js2py方法如下：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/VeNoMouS/cloudflare-scrape-js2py.git</span><br><span class="line">$ sudo python3 setup.py install</span><br></pre></td></tr></table></figure></p>
<p>由于Cloudflare不断改变和强化其保护页面，最初使用的 cloudflare-scrape很快就不能用了，当然可以去提交问题或者查看相关问题的解决方案。<br>我也是各种尝试各种查，不过最后换了 cloudflare-scrape-js2py就解决了问题。</p>
<p>主要代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">session = requests.session()</span><br><span class="line">scraper = cfscrape.create_scraper(sess=session)</span><br><span class="line">scraper = cfscrape.create_scraper(delay=<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">req = scraper.get(url)</span><br><span class="line">html = req.text</span><br></pre></td></tr></table></figure></p>
<h2><span id="post中参数abc的解析">post中参数a,b,c的解析</span></h2><p>get-&gt;url 返回源码如下图（部分）：<br><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24qcdqgfgj20v40ilq9l.jpg" alt></p>
<h3><span id="post中参数abc的解析">post中参数a,b,c的解析</span></h3><p>网页源码js中的参数a,b,c<br>解析a,b,c参数主要是依赖正常显示的url的源码中的js代码，如下图重点地方以划出。<br>上图第一个被划线的一句js如下：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (detect) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">'317d2cefb40586a9'</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="string">'e1a5f5499211cbd4'</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="string">'e59ab31720d6cf48'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="string">'e59ab31720d6cf48'</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="string">'317d2cefb40586a9'</span>;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">'e1a5f5499211cbd4'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>根据多次观察，可知每次需要取else中的a,b,c的值，代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取页面源码中else&#123;后面的abc的值</span></span><br><span class="line"><span class="comment"># 参数值只能为: 'a' ,'b', 'c'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_var_abc</span><span class="params">(key=<span class="string">'a'</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 反向查找 并截取</span></span><br><span class="line">    ivs = key + <span class="string">"='"</span></span><br><span class="line">    ivl = html.rindex(ivs)</span><br><span class="line">    key = html[ivl + len(ivs): ivl + len(ivs) + <span class="number">16</span>]</span><br><span class="line">    <span class="keyword">return</span> key</span><br></pre></td></tr></table></figure></p>
<p>二维码（base64文本）解码<br>上图中<em>docodeImage</em>方法中第一个参数值如下：</p>
<p><code>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAABXAQMAAABLBksvAAAABlBMVEX///8AAABVwtN+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAq0lEQVQ4jc3Ruw0DIQwGYEcu3B0LRGINOmbKAgm3AKxExxpIXiDXUURxjkgnXXExKe+vPjfgB8DZYkQisEhVPAEGwgCqPUePqQ2cMo8tOPAf/fT+3W6WI6+5bPhlIxjd1bSqePIv0+TtNAPhUjCJ5vW1R5ZIukUaLw0U97LYuWhe9xDIBtLc9+nq3VXNnufMEQaODm7ffzUTL1k1YCr83G596H5fstJA8bnyAVNpDVwJjnB4AAAAAElFTkSuQmCC</code></p>
<p>这个参数值相当于一个图片的base64编码，其实就是一个二维码。<br>这个二维码是一个长度为16的字符，其实也是post中的一个参数值。</p>
<p>代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接通过base64字符串解析二维码；获取二维码的值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_qrcode</span><span class="params">(html)</span>:</span></span><br><span class="line">    qrdatas = html.split(<span class="string">'data:image/png;base64,'</span>)[<span class="number">1</span>].split(<span class="string">"',"</span>)[<span class="number">0</span>]</span><br><span class="line">    qrbytes = bytes(qrdatas, encoding=<span class="string">"ascii"</span>)</span><br><span class="line">    decode_result = decode(Image.open(BytesIO(codecs.decode(qrbytes,<span class="string">'base64'</span>))))</span><br><span class="line">    qrvalue =str(decode_result[<span class="number">0</span>].data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> qrvalue</span><br></pre></td></tr></table></figure></p>
<h3><span id="post参数abc值的确定">post参数a,b,c值的确定</span></h3><p>上图中的一段省略版的js代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">decodeImage(<span class="string">'data:image/png;base64,iVBORw0KGxx...xxwJjnB4AAAAAElFTkSuQmCC'</span>, </span><br><span class="line">    function(c) &#123;</span><br><span class="line">        $.post(<span class="string">"data.php"</span>,&#123;a:a,b:b,c:encc(c)&#125;,</span><br></pre></td></tr></table></figure></p>
<p>多次观察发现<em>function(key)</em>方法中的参数随机a,b,c任一，而这个随机参数(a/b/c)需要用<strong>二维码的值</strong>来替代。<br><strong>说明：post中的a,b,c的值是依赖js中的a,b,c的值和二维码的值</strong>，所以a,b,c的值要注意以免混淆。</p>
<p>代码如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据规则分别求出3种情况下的a,b,c</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_param_abc</span><span class="params">(html)</span>:</span></span><br><span class="line">    a = get_var_abc(key=<span class="string">'a'</span>)</span><br><span class="line">    b = get_var_abc(key=<span class="string">'b'</span>)</span><br><span class="line">    c = get_var_abc(key=<span class="string">'c'</span>)</span><br><span class="line">    symbolKey = html.split(<span class="string">'data:image/png;base64,'</span>)[<span class="number">1</span>].split(<span class="string">"function("</span>)[<span class="number">1</span>][:<span class="number">1</span>]</span><br><span class="line">    print(<span class="string">'symbolKey'</span>,symbolKey)</span><br><span class="line">    print(symbolKey==<span class="string">'a'</span>,symbolKey==<span class="string">'b'</span>,symbolKey==<span class="string">'c'</span>)</span><br><span class="line">    <span class="keyword">if</span> symbolKey == <span class="string">'a'</span>:</span><br><span class="line">        a = decode_qrcode(html)</span><br><span class="line">    <span class="keyword">elif</span> symbolKey == <span class="string">'b'</span>:</span><br><span class="line">        b = decode_qrcode(html)</span><br><span class="line">    <span class="keyword">elif</span> symbolKey == <span class="string">'c'</span>:</span><br><span class="line">        c = decode_qrcode(html)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># js2py.translate_file('encc.min.js', 'encc.py')</span></span><br><span class="line">    <span class="keyword">from</span> encc <span class="keyword">import</span> PyJsHoisted_encc_</span><br><span class="line">    c = PyJsHoisted_encc_(c).value</span><br><span class="line">    print(<span class="string">'\n%s\n%s\n%s'</span>% (a,b,c))</span><br><span class="line">    <span class="keyword">return</span> a,b,c</span><br></pre></td></tr></table></figure></p>
<h3><span id="post参数c的值的加密">post参数c的值的加密</span></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.post(<span class="string">"data.php"</span>, &#123;</span><br><span class="line">    a: a,</span><br><span class="line">    b: b,</span><br><span class="line">    c: encc(c)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>这一行是js中post的请求，是固定的对参数c进行加密，网站中的js加密算法比较清晰。<br>这时的思路有3种：</p>
<ol>
<li>直接通过python执行js代码；</li>
<li>第三方（库）自动代码转换（ js-&gt;python ）；</li>
<li>根据js中的加密思想，手动进行python编码；</li>
</ol>
<p>比较推荐前2种方法，毕竟第3种手动转码太难太耗时间。<br>这里推荐2个执行js的库：<strong>Js2Py</strong>，PyExeJs<br>本文使用的是Js2Py，这个强大的库可以直接执行js代码和转换js文件。</p>
<p>所以这行js对应的python代码为：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a,b,c = get_param_abc(html)</span><br><span class="line"></span><br><span class="line">#post提交a,b,c,得到密文</span><br><span class="line">payload = &#123;<span class="string">'a'</span>:a,<span class="string">'b'</span>:b,<span class="string">'c'</span>:c&#125;</span><br><span class="line">session.cookies = scraper.cookies  # 必须带上cookies</span><br><span class="line">req = scraper.post(url2,data=payload)</span><br><span class="line">msg = req.text</span><br></pre></td></tr></table></figure></p>
<h2><span id="aes加密数据解码">AES加密数据解码</span></h2><h3><span id="确定aes加密模式弃用">确定AES加密模式（弃用）</span></h3><p>最初是想用判断语句指定加密模式参数，但有幸后来看到大牛的好方法。<br>不过有一个小点需要说明一下，就是可以从js源码中分析出来加密参数；<br>如上节图上被括起来的js文本如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//js eval加密文本</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span>(<span class="params">p,a,c,k,e,d</span>)</span>&#123;e=<span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span>(c&lt;a?<span class="string">""</span>:e(<span class="built_in">parseInt</span>(c/a)))+((c=c%a)&gt;<span class="number">35</span>?<span class="built_in">String</span>.fromCharCode(c+<span class="number">29</span>):c.toString(<span class="number">36</span>))&#125;;<span class="keyword">if</span>(!<span class="string">''</span>.replace(<span class="regexp">/^/</span>,<span class="built_in">String</span>))&#123;<span class="keyword">while</span>(c--)d[e(c)]=k[c]||e(c);k=[<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">return</span> d[e]&#125;];e=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">'\\w+'</span>&#125;;c=<span class="number">1</span>;&#125;;<span class="keyword">while</span>(c--)<span class="keyword">if</span>(k[c])p=p.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\\b'</span>+e(c)+<span class="string">'\\b'</span>,<span class="string">'g'</span>),k[c]);<span class="keyword">return</span> p;&#125;(<span class="string">'1 2=\'4\'+\'h\'+\'8\'+\'9\'+\'a\';1 5=\'3\'+\'6\';1 7=0.b.g(d,i,&#123;c:e,2:0.2.4,f:0.5.3&#125;);'</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="string">'CryptoJS|var|mode|Pkcs7|CBC|pad|ZeroPadding|dec|CTR|ECB|OFB|AES|iv||y|padding|decrypt|CFB|x'</span>.split(<span class="string">'|'</span>),<span class="number">0</span>,&#123;&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">//js 解密（解压缩）后的文本</span></span><br><span class="line"><span class="keyword">var</span> mode = <span class="string">'CBC'</span> + <span class="string">'CFB'</span> + <span class="string">'CTR'</span> + <span class="string">'ECB'</span> + <span class="string">'OFB'</span>;</span><br><span class="line"><span class="keyword">var</span> pad = <span class="string">'Pkcs7'</span> + <span class="string">'ZeroPadding'</span>;</span><br><span class="line"><span class="keyword">var</span> dec = CryptoJS.AES.decrypt(d, x, &#123;</span><br><span class="line">    iv: y,</span><br><span class="line">    mode: CryptoJS.mode.CBC,</span><br><span class="line">    padding: CryptoJS.pad.Pkcs7</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3><span id="免判断加密模式并解密推荐">免判断加密模式并解密（推荐）</span></h3><p>中间和朋友电话闲聊中问过一句模式的选择，朋友只是说模式不重要；当时就觉得应该有一种遍历类型的解法。</p>
<p>根据js代码可知：下面python代码的<em>decrypt_data</em>方法的参数<em>key，iv</em>分别对应post参数的<em>a，b</em>；即：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">endata = base64.b64decode(msg)</span><br><span class="line">key = bytes(a,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">iv  = bytes(b,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">ssdata = decrypt_data(key, iv, endata)</span><br></pre></td></tr></table></figure></p>
<p>由此对应的python代码如下：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""解密数据得到ss信息，返回list对象"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_data</span><span class="params">(key, iv, endata)</span>:</span></span><br><span class="line">    ctr = Counter.new(<span class="number">128</span>, initial_value=int(binascii.hexlify(iv), <span class="number">16</span>))</span><br><span class="line">    modes = [</span><br><span class="line">        AES.new(key, AES.MODE_ECB),</span><br><span class="line">        AES.new(key, AES.MODE_CBC, iv),</span><br><span class="line">        AES.new(key, AES.MODE_OFB, iv),</span><br><span class="line">        AES.new(key, AES.MODE_CTR, counter=ctr),</span><br><span class="line">        AES.new(key, AES.MODE_CFB, iv, segment_size=<span class="number">128</span>)</span><br><span class="line">    ]</span><br><span class="line">    rtdatas = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> mode <span class="keyword">in</span> modes:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            dec = mode.decrypt(endata).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            print(dec[<span class="number">-200</span>:])     <span class="comment"># 解密后文本结尾可能存在'\0'</span></span><br><span class="line">            dec = dec.rstrip(<span class="string">'\0'</span>)  <span class="comment"># 去除结尾空白符'\0'</span></span><br><span class="line">            rtdatas = json.loads(dec)[<span class="string">'data'</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> rtdatas</span><br></pre></td></tr></table></figure>
<p>网站的加密模式是5种的随机的一种，其中可能遇到CFB模式中会报错，后来发现pycryto的版本问题，安装pycrytodome即可。</p>
<h3><span id="解码数据并测延时">解码数据并测延时</span></h3><p>post密文解密后是json的文本，下图是格式化片段：</p>
<p><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24qxyazfrj20sv08tgpg.jpg" alt></p>
<p>账号的处理及测试可参考github大神的方法：<strong><a href="https://github.com/free-ss/free-ss.site/blob/master/%E6%A3%80%E6%B5%8B%E7%A8%8B%E5%BA%8F%E4%BB%8B%E7%BB%8D.md" target="_blank" rel="noopener">检测程序介绍</a></strong></p>
<h1><span id="最后">最后</span></h1><p>对于这个网站学习挺好，其他就不要多想了。</p>
<h2><span id="相关资源">相关资源</span></h2><h3><span id="本文相关库">本文相关库</span></h3><p>python=3.6.5<br>brotli=1.0.7<br>cfscrape=2.0.3<br>requests=2.21.0<br>Js2Py=0.60<br>Pillow=5.1.0    # Pillow(PIL Fork)<br>cryptodemo=0.0.1</p>
<h3><span id="第三方开源库">第三方开源库</span></h3><p><a href="https://github.com/Anorov/cloudflare-scrape" target="_blank" rel="noopener">https://github.com/Anorov/cloudflare-scrape</a><br><a href="https://github.com/VeNoMouS/cloudflare-scrape-js2py" target="_blank" rel="noopener">https://github.com/VeNoMouS/cloudflare-scrape-js2py</a></p>
<p><a href="https://github.com/PiotrDabkowski/Js2Py" target="_blank" rel="noopener">https://github.com/PiotrDabkowski/Js2Py</a></p>
<h3><span id="在线测试工具">在线测试工具</span></h3><p>在线二维码-Convert Your Base64 to Image<br><a href="https://codebeautify.org/base64-to-image-converter" target="_blank" rel="noopener">https://codebeautify.org/base64-to-image-converter</a><br>js在线解密/美化<br><a href="https://tool.lu/js/" target="_blank" rel="noopener">https://tool.lu/js/</a><br>在线json解析<br><a href="https://www.sojson.com/" target="_blank" rel="noopener">https://www.sojson.com/</a></p>
<hr>
<h3><span id="参考">参考</span></h3><p>binascii.Error: Incorrect padding, even when string length is multiple of 4<br><a href="https://stackoverflow.com/questions/45879045/binascii-error-incorrect-padding-even-when-string-length-is-multiple-of-4" target="_blank" rel="noopener">https://stackoverflow.com/questions/45879045/binascii-error-incorrect-padding-even-when-string-length-is-multiple-of-4</a></p>
<p>python字符串str和字节数组相互转化<br><a href="https://www.cnblogs.com/hhh5460/p/5243305.html" target="_blank" rel="noopener">https://www.cnblogs.com/hhh5460/p/5243305.html</a></p>
<p>Python3操作二维码图片<br><a href="http://blog.niuhemoon.xyz/pages/2018/04/27/Python3-QRcode/" target="_blank" rel="noopener">http://blog.niuhemoon.xyz/pages/2018/04/27/Python3-QRcode/</a></p>
<p>关于xxx网站js加密算法的研究<br><a href="https://github.com/gcdd1993/analyzeSS" target="_blank" rel="noopener">https://github.com/gcdd1993/analyzeSS</a></p>
<p>Python爬取某站科学上网帐号(5.15更新)<br><a href="https://mtaoist.xyz/2018/04/07/python-getss/" target="_blank" rel="noopener">https://mtaoist.xyz/2018/04/07/python-getss/</a><br>xiaoTaoist：Auto-Shadowsocks项目<br><a href="https://github.com/xiaoTaoist/Auto-Shadowsocks" target="_blank" rel="noopener">https://github.com/xiaoTaoist/Auto-Shadowsocks</a></p>
</div><div class="tags"><a href="/tags/爬虫/">爬虫</a><a href="/tags/ss/">ss</a></div><div class="post-nav"><a class="next" href="/2019/04/14/hello-world/">hello</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> Kategorien</i></div></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> Tags</i></div><div class="tagcloud"><a href="/tags/图床/" style="font-size: 15px;">图床</a> <a href="/tags/爬虫/" style="font-size: 15px;">爬虫</a> <a href="/tags/ss/" style="font-size: 15px;">ss</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> Letzte</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/04/14/一个免费ss网站的数据爬取过程/">一个免费ss网站的数据爬取过程</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/14/hello-world/">hello</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/04/14/ubuntu+xclip+imgbb图床脚本/">ubuntu+java+imgbb图床脚本</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> Blogroll</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">Hexo.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>