<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Oucbl</title>
  
  <subtitle>一个狗才程序猿</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://oucbl.github.io/"/>
  <updated>2019-04-17T18:21:18.949Z</updated>
  <id>https://oucbl.github.io/</id>
  
  <author>
    <name>保罗</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>一个免费ss网站的数据爬取过程</title>
    <link href="https://oucbl.github.io/blogs/656a7ed5/"/>
    <id>https://oucbl.github.io/blogs/656a7ed5/</id>
    <published>2019-04-14T08:47:41.000Z</published>
    <updated>2019-04-17T18:21:18.949Z</updated>
    
    <content type="html"><![CDATA[<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>偶然发现一个免费ss分享网站，本以为简单的url请求即可获取数据。但是没想到在网站的反爬机制很严格，这反而激起了我的好奇心。</p><p>不过对于爬虫经验技术来说，是一个很好的学习检验的机会。</p><h1 id="爬虫整体概况"><a href="#爬虫整体概况" class="headerlink" title="爬虫整体概况"></a>爬虫整体概况</h1><p>数据获取的核心是围绕2个<strong>http请求</strong>：</p><table><thead><tr><th style="text-align:center">方法</th><th style="text-align:center">地址</th><th style="text-align:center">参数</th><th>备注</th></tr></thead><tbody><tr><td style="text-align:center">get</td><td style="text-align:center">url</td><td style="text-align:center">无</td><td>响应源码中有可用信息</td></tr><tr><td style="text-align:center">post</td><td style="text-align:center">url1</td><td style="text-align:center">a,b,c</td><td>返回加密数据文本</td></tr></tbody></table><p><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24pnzo80gj20pa0oywhi.jpg" alt></p><h1 id="主要功能方法"><a href="#主要功能方法" class="headerlink" title="主要功能方法"></a>主要功能方法</h1><h2 id="绕过DDOS保护（Cloudflare）"><a href="#绕过DDOS保护（Cloudflare）" class="headerlink" title="绕过DDOS保护（Cloudflare）"></a>绕过DDOS保护（Cloudflare）</h2><p>简单来讲cloudflare就是通过js验证访问是否来至真正的web浏览器。</p><p><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24q32f71mj20hi05zaag.jpg" alt></p><p>如上图所示，访问url 时候一般会进入5秒左右倒计时；请求状态码是503。<br>通过抓包可以看到503请求数秒后跳转一个类似“<a href="https://xxxxx/cdn-cgi/l/chk_jschl?s=xxx”的302请求，成功后即可跳转到期望页面。" target="_blank" rel="noopener">https://xxxxx/cdn-cgi/l/chk_jschl?s=xxx”的302请求，成功后即可跳转到期望页面。</a></p><p><strong>解决方法：</strong>使用任意一个第三方库：cloudflare-scrape 或者 <strong>cloudflare-scrape-js2py</strong><br>这2个库方法通用，安装cloudflare-scrape-js2py方法如下：<br></p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/VeNoMouS/cloudflare-scrape-js2py.git</span><br><span class="line">$ sudo python3 setup.py install</span><br></pre></td></tr></table></figure><p></p><p>由于Cloudflare不断改变和强化其保护页面，最初使用的 cloudflare-scrape很快就不能用了，当然可以去提交问题或者查看相关问题的解决方案。<br>我也是各种尝试各种查，不过最后换了 cloudflare-scrape-js2py就解决了问题。</p><p>主要代码如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">session = requests.session()</span><br><span class="line">scraper = cfscrape.create_scraper(sess=session)</span><br><span class="line">scraper = cfscrape.create_scraper(delay=<span class="number">11</span>)</span><br><span class="line"></span><br><span class="line">req = scraper.get(url)</span><br><span class="line">html = req.text</span><br></pre></td></tr></table></figure><p></p><h2 id="post中参数a-b-c的解析"><a href="#post中参数a-b-c的解析" class="headerlink" title="post中参数a,b,c的解析"></a>post中参数a,b,c的解析</h2><p>get-&gt;url 返回源码如下图（部分）：<br><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24qcdqgfgj20v40ilq9l.jpg" alt></p><h3 id="post中参数a-b-c的解析-1"><a href="#post中参数a-b-c的解析-1" class="headerlink" title="post中参数a,b,c的解析"></a>post中参数a,b,c的解析</h3><p>网页源码js中的参数a,b,c<br>解析a,b,c参数主要是依赖正常显示的url的源码中的js代码，如下图重点地方以划出。<br>上图第一个被划线的一句js如下：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (detect) &#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">'317d2cefb40586a9'</span>;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="string">'e1a5f5499211cbd4'</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="string">'e59ab31720d6cf48'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">var</span> b = <span class="string">'e59ab31720d6cf48'</span>;</span><br><span class="line">    <span class="keyword">var</span> c = <span class="string">'317d2cefb40586a9'</span>;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="string">'e1a5f5499211cbd4'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p></p><p>根据多次观察，可知每次需要取else中的a,b,c的值，代码如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取页面源码中else&#123;后面的abc的值</span></span><br><span class="line"><span class="comment"># 参数值只能为: 'a' ,'b', 'c'</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_var_abc</span><span class="params">(key=<span class="string">'a'</span>)</span>:</span></span><br><span class="line">    <span class="comment"># 反向查找 并截取</span></span><br><span class="line">    ivs = key + <span class="string">"='"</span></span><br><span class="line">    ivl = html.rindex(ivs)</span><br><span class="line">    key = html[ivl + len(ivs): ivl + len(ivs) + <span class="number">16</span>]</span><br><span class="line">    <span class="keyword">return</span> key</span><br></pre></td></tr></table></figure><p></p><p>二维码（base64文本）解码<br>上图中<em>docodeImage</em>方法中第一个参数值如下：</p><p><code>data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFcAAABXAQMAAABLBksvAAAABlBMVEX///8AAABVwtN+AAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAq0lEQVQ4jc3Ruw0DIQwGYEcu3B0LRGINOmbKAgm3AKxExxpIXiDXUURxjkgnXXExKe+vPjfgB8DZYkQisEhVPAEGwgCqPUePqQ2cMo8tOPAf/fT+3W6WI6+5bPhlIxjd1bSqePIv0+TtNAPhUjCJ5vW1R5ZIukUaLw0U97LYuWhe9xDIBtLc9+nq3VXNnufMEQaODm7ffzUTL1k1YCr83G596H5fstJA8bnyAVNpDVwJjnB4AAAAAElFTkSuQmCC</code></p><p>这个参数值相当于一个图片的base64编码，其实就是一个二维码。<br>这个二维码是一个长度为16的字符，其实也是post中的一个参数值。</p><p>代码如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 直接通过base64字符串解析二维码；获取二维码的值</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_qrcode</span><span class="params">(html)</span>:</span></span><br><span class="line">    qrdatas = html.split(<span class="string">'data:image/png;base64,'</span>)[<span class="number">1</span>].split(<span class="string">"',"</span>)[<span class="number">0</span>]</span><br><span class="line">    qrbytes = bytes(qrdatas, encoding=<span class="string">"ascii"</span>)</span><br><span class="line">    decode_result = decode(Image.open(BytesIO(codecs.decode(qrbytes,<span class="string">'base64'</span>))))</span><br><span class="line">    qrvalue =str(decode_result[<span class="number">0</span>].data, encoding=<span class="string">'utf-8'</span>)</span><br><span class="line">    <span class="keyword">return</span> qrvalue</span><br></pre></td></tr></table></figure><p></p><h3 id="post参数a-b-c值的确定"><a href="#post参数a-b-c值的确定" class="headerlink" title="post参数a,b,c值的确定"></a>post参数a,b,c值的确定</h3><p>上图中的一段省略版的js代码如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">decodeImage(<span class="string">'data:image/png;base64,iVBORw0KGxx...xxwJjnB4AAAAAElFTkSuQmCC'</span>,</span><br><span class="line">    function(c) &#123;</span><br><span class="line">        $.post(<span class="string">"data.php"</span>,&#123;a:a,b:b,c:encc(c)&#125;,</span><br></pre></td></tr></table></figure><p></p><p>多次观察发现<em>function(key)</em>方法中的参数随机a,b,c任一，而这个随机参数(a/b/c)需要用<strong>二维码的值</strong>来替代。<br><strong>说明：post中的a,b,c的值是依赖js中的a,b,c的值和二维码的值</strong>，所以a,b,c的值要注意以免混淆。</p><p>代码如下：<br></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根据规则分别求出3种情况下的a,b,c</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_param_abc</span><span class="params">(html)</span>:</span></span><br><span class="line">    a = get_var_abc(key=<span class="string">'a'</span>)</span><br><span class="line">    b = get_var_abc(key=<span class="string">'b'</span>)</span><br><span class="line">    c = get_var_abc(key=<span class="string">'c'</span>)</span><br><span class="line">    symbolKey = html.split(<span class="string">'data:image/png;base64,'</span>)[<span class="number">1</span>].split(<span class="string">"function("</span>)[<span class="number">1</span>][:<span class="number">1</span>]</span><br><span class="line">    print(<span class="string">'symbolKey'</span>,symbolKey)</span><br><span class="line">    print(symbolKey==<span class="string">'a'</span>,symbolKey==<span class="string">'b'</span>,symbolKey==<span class="string">'c'</span>)</span><br><span class="line">    <span class="keyword">if</span> symbolKey == <span class="string">'a'</span>:</span><br><span class="line">        a = decode_qrcode(html)</span><br><span class="line">    <span class="keyword">elif</span> symbolKey == <span class="string">'b'</span>:</span><br><span class="line">        b = decode_qrcode(html)</span><br><span class="line">    <span class="keyword">elif</span> symbolKey == <span class="string">'c'</span>:</span><br><span class="line">        c = decode_qrcode(html)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># js2py.translate_file('encc.min.js', 'encc.py')</span></span><br><span class="line">    <span class="keyword">from</span> encc <span class="keyword">import</span> PyJsHoisted_encc_</span><br><span class="line">    c = PyJsHoisted_encc_(c).value</span><br><span class="line">    print(<span class="string">'\n%s\n%s\n%s'</span>% (a,b,c))</span><br><span class="line">    <span class="keyword">return</span> a,b,c</span><br></pre></td></tr></table></figure><p></p><h3 id="post参数c的值的加密"><a href="#post参数c的值的加密" class="headerlink" title="post参数c的值的加密"></a>post参数c的值的加密</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$.post(<span class="string">"data.php"</span>, &#123;</span><br><span class="line">    a: a,</span><br><span class="line">    b: b,</span><br><span class="line">    c: encc(c)</span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure><p>这一行是js中post的请求，是固定的对参数c进行加密，网站中的js加密算法比较清晰。<br>这时的思路有3种：</p><ol><li>直接通过python执行js代码；</li><li>第三方（库）自动代码转换（ js-&gt;python ）；</li><li>根据js中的加密思想，手动进行python编码；</li></ol><p>比较推荐前2种方法，毕竟第3种手动转码太难太耗时间。<br>这里推荐2个执行js的库：<strong>Js2Py</strong>，PyExeJs<br>本文使用的是Js2Py，这个强大的库可以直接执行js代码和转换js文件。</p><p>所以这行js对应的python代码为：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a,b,c = get_param_abc(html)</span><br><span class="line"></span><br><span class="line">#post提交a,b,c,得到密文</span><br><span class="line">payload = &#123;<span class="string">'a'</span>:a,<span class="string">'b'</span>:b,<span class="string">'c'</span>:c&#125;</span><br><span class="line">session.cookies = scraper.cookies  # 必须带上cookies</span><br><span class="line">req = scraper.post(url2,data=payload)</span><br><span class="line">msg = req.text</span><br></pre></td></tr></table></figure><p></p><h2 id="AES加密数据解码"><a href="#AES加密数据解码" class="headerlink" title="AES加密数据解码"></a>AES加密数据解码</h2><h3 id="确定AES加密模式（弃用）"><a href="#确定AES加密模式（弃用）" class="headerlink" title="确定AES加密模式（弃用）"></a>确定AES加密模式（弃用）</h3><p>最初是想用判断语句指定加密模式参数，但有幸后来看到大牛的好方法。<br>不过有一个小点需要说明一下，就是可以从js源码中分析出来加密参数；<br>如上节图上被括起来的js文本如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//js eval加密文本</span></span><br><span class="line"><span class="built_in">eval</span>(<span class="function"><span class="keyword">function</span>(<span class="params">p,a,c,k,e,d</span>)</span>&#123;e=<span class="function"><span class="keyword">function</span>(<span class="params">c</span>)</span>&#123;<span class="keyword">return</span>(c&lt;a?<span class="string">""</span>:e(<span class="built_in">parseInt</span>(c/a)))+((c=c%a)&gt;<span class="number">35</span>?<span class="built_in">String</span>.fromCharCode(c+<span class="number">29</span>):c.toString(<span class="number">36</span>))&#125;;<span class="keyword">if</span>(!<span class="string">''</span>.replace(<span class="regexp">/^/</span>,<span class="built_in">String</span>))&#123;<span class="keyword">while</span>(c--)d[e(c)]=k[c]||e(c);k=[<span class="function"><span class="keyword">function</span>(<span class="params">e</span>)</span>&#123;<span class="keyword">return</span> d[e]&#125;];e=<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="keyword">return</span><span class="string">'\\w+'</span>&#125;;c=<span class="number">1</span>;&#125;;<span class="keyword">while</span>(c--)<span class="keyword">if</span>(k[c])p=p.replace(<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'\\b'</span>+e(c)+<span class="string">'\\b'</span>,<span class="string">'g'</span>),k[c]);<span class="keyword">return</span> p;&#125;(<span class="string">'1 2=\'4\'+\'h\'+\'8\'+\'9\'+\'a\';1 5=\'3\'+\'6\';1 7=0.b.g(d,i,&#123;c:e,2:0.2.4,f:0.5.3&#125;);'</span>,<span class="number">19</span>,<span class="number">19</span>,<span class="string">'CryptoJS|var|mode|Pkcs7|CBC|pad|ZeroPadding|dec|CTR|ECB|OFB|AES|iv||y|padding|decrypt|CFB|x'</span>.split(<span class="string">'|'</span>),<span class="number">0</span>,&#123;&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">//js 解密（解压缩）后的文本</span></span><br><span class="line"><span class="keyword">var</span> mode = <span class="string">'CBC'</span> + <span class="string">'CFB'</span> + <span class="string">'CTR'</span> + <span class="string">'ECB'</span> + <span class="string">'OFB'</span>;</span><br><span class="line"><span class="keyword">var</span> pad = <span class="string">'Pkcs7'</span> + <span class="string">'ZeroPadding'</span>;</span><br><span class="line"><span class="keyword">var</span> dec = CryptoJS.AES.decrypt(d, x, &#123;</span><br><span class="line">    iv: y,</span><br><span class="line">    mode: CryptoJS.mode.CBC,</span><br><span class="line">    padding: CryptoJS.pad.Pkcs7</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3 id="免判断加密模式并解密（推荐）"><a href="#免判断加密模式并解密（推荐）" class="headerlink" title="免判断加密模式并解密（推荐）"></a>免判断加密模式并解密（推荐）</h3><p>中间和朋友电话闲聊中问过一句模式的选择，朋友只是说模式不重要；当时就觉得应该有一种遍历类型的解法。</p><p>根据js代码可知：下面python代码的<em>decrypt_data</em>方法的参数<em>key，iv</em>分别对应post参数的<em>a，b</em>；即：<br></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">endata = base64.b64decode(msg)</span><br><span class="line">key = bytes(a,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">iv  = bytes(b,encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"></span><br><span class="line">ssdata = decrypt_data(key, iv, endata)</span><br></pre></td></tr></table></figure><p></p><p>由此对应的python代码如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""解密数据得到ss信息，返回list对象"""</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_data</span><span class="params">(key, iv, endata)</span>:</span></span><br><span class="line">    ctr = Counter.new(<span class="number">128</span>, initial_value=int(binascii.hexlify(iv), <span class="number">16</span>))</span><br><span class="line">    modes = [</span><br><span class="line">        AES.new(key, AES.MODE_ECB),</span><br><span class="line">        AES.new(key, AES.MODE_CBC, iv),</span><br><span class="line">        AES.new(key, AES.MODE_OFB, iv),</span><br><span class="line">        AES.new(key, AES.MODE_CTR, counter=ctr),</span><br><span class="line">        AES.new(key, AES.MODE_CFB, iv, segment_size=<span class="number">128</span>)</span><br><span class="line">    ]</span><br><span class="line">    rtdatas = <span class="literal">None</span></span><br><span class="line">    <span class="keyword">for</span> mode <span class="keyword">in</span> modes:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            dec = mode.decrypt(endata).decode(<span class="string">'utf-8'</span>)</span><br><span class="line">            print(dec[<span class="number">-200</span>:])     <span class="comment"># 解密后文本结尾可能存在'\0'</span></span><br><span class="line">            dec = dec.rstrip(<span class="string">'\0'</span>)  <span class="comment"># 去除结尾空白符'\0'</span></span><br><span class="line">            rtdatas = json.loads(dec)[<span class="string">'data'</span>]</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> rtdatas</span><br></pre></td></tr></table></figure><p>网站的加密模式是5种的随机的一种，其中可能遇到CFB模式中会报错，后来发现pycryto的版本问题，安装pycrytodome即可。</p><h3 id="解码数据并测延时"><a href="#解码数据并测延时" class="headerlink" title="解码数据并测延时"></a>解码数据并测延时</h3><p>post密文解密后是json的文本，下图是格式化片段：</p><p><img src="http://ww1.sinaimg.cn/large/9d89d613ly1g24qxyazfrj20sv08tgpg.jpg" alt></p><p>账号的处理及测试可参考github大神的方法：<strong><a href="https://github.com/free-ss/free-ss.site/blob/master/%E6%A3%80%E6%B5%8B%E7%A8%8B%E5%BA%8F%E4%BB%8B%E7%BB%8D.md" target="_blank" rel="noopener">检测程序介绍</a></strong></p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>对于这个网站学习挺好，其他就不要多想了。</p><h2 id="相关资源"><a href="#相关资源" class="headerlink" title="相关资源"></a>相关资源</h2><h3 id="本文相关库"><a href="#本文相关库" class="headerlink" title="本文相关库"></a>本文相关库</h3><p>python=3.6.5<br>brotli=1.0.7<br>cfscrape=2.0.3<br>requests=2.21.0<br>Js2Py=0.60<br>Pillow=5.1.0 # Pillow(PIL Fork)<br>cryptodemo=0.0.1</p><h3 id="第三方开源库"><a href="#第三方开源库" class="headerlink" title="第三方开源库"></a>第三方开源库</h3><p><a href="https://github.com/Anorov/cloudflare-scrape" target="_blank" rel="noopener">https://github.com/Anorov/cloudflare-scrape</a><br><a href="https://github.com/VeNoMouS/cloudflare-scrape-js2py" target="_blank" rel="noopener">https://github.com/VeNoMouS/cloudflare-scrape-js2py</a></p><p><a href="https://github.com/PiotrDabkowski/Js2Py" target="_blank" rel="noopener">https://github.com/PiotrDabkowski/Js2Py</a></p><h3 id="在线测试工具"><a href="#在线测试工具" class="headerlink" title="在线测试工具"></a>在线测试工具</h3><p>在线二维码-Convert Your Base64 to Image<br><a href="https://codebeautify.org/base64-to-image-converter" target="_blank" rel="noopener">https://codebeautify.org/base64-to-image-converter</a><br>js在线解密/美化<br><a href="https://tool.lu/js/" target="_blank" rel="noopener">https://tool.lu/js/</a><br>在线json解析<br><a href="https://www.sojson.com/" target="_blank" rel="noopener">https://www.sojson.com/</a></p><hr><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>binascii.Error: Incorrect padding, even when string length is multiple of 4<br><a href="https://stackoverflow.com/questions/45879045/binascii-error-incorrect-padding-even-when-string-length-is-multiple-of-4" target="_blank" rel="noopener">https://stackoverflow.com/questions/45879045/binascii-error-incorrect-padding-even-when-string-length-is-multiple-of-4</a></p><p>python字符串str和字节数组相互转化<br><a href="https://www.cnblogs.com/hhh5460/p/5243305.html" target="_blank" rel="noopener">https://www.cnblogs.com/hhh5460/p/5243305.html</a></p><p>Python3操作二维码图片<br><a href="http://blog.niuhemoon.xyz/pages/2018/04/27/Python3-QRcode/" target="_blank" rel="noopener">http://blog.niuhemoon.xyz/pages/2018/04/27/Python3-QRcode/</a></p><p>关于xxx网站js加密算法的研究<br><a href="https://github.com/gcdd1993/analyzeSS" target="_blank" rel="noopener">https://github.com/gcdd1993/analyzeSS</a></p><p>Python爬取某站科学上网帐号(5.15更新)<br><a href="https://mtaoist.xyz/2018/04/07/python-getss/" target="_blank" rel="noopener">https://mtaoist.xyz/2018/04/07/python-getss/</a><br>xiaoTaoist：Auto-Shadowsocks项目<br><a href="https://github.com/xiaoTaoist/Auto-Shadowsocks" target="_blank" rel="noopener">https://github.com/xiaoTaoist/Auto-Shadowsocks</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;引言&quot;&gt;&lt;a href=&quot;#引言&quot; class=&quot;headerlink&quot; title=&quot;引言&quot;&gt;&lt;/a&gt;引言&lt;/h1&gt;&lt;p&gt;偶然发现一个免费ss分享网站，本以为简单的url请求即可获取数据。但是没想到在网站的反爬机制很严格，这反而激起了我的好奇心。&lt;/p&gt;&lt;p&gt;不
      
    
    </summary>
    
      <category term="科学上网" scheme="https://oucbl.github.io/categories/%E7%A7%91%E5%AD%A6%E4%B8%8A%E7%BD%91/"/>
    
    
      <category term="SS" scheme="https://oucbl.github.io/tags/SS/"/>
    
      <category term="Python" scheme="https://oucbl.github.io/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>ubuntu+java+imgbb图床脚本</title>
    <link href="https://oucbl.github.io/blogs/58bb5a76/"/>
    <id>https://oucbl.github.io/blogs/58bb5a76/</id>
    <published>2019-04-13T19:20:11.000Z</published>
    <updated>2019-04-18T15:18:35.264Z</updated>
    
    <content type="html"><![CDATA[<h1 id="Markdown图床"><a href="#Markdown图床" class="headerlink" title="Markdown图床"></a>Markdown图床</h1><h2 id="图床需求"><a href="#图床需求" class="headerlink" title="图床需求"></a>图床需求</h2><p>接触markedown三年左右，不经常写。刚开始用过一段“小书匠”写<a href="http://www.cnblogs.com/oucbl/" target="_blank" rel="noopener">博客园</a>，主要是语法兼容和图床的问题，还不能跨平台。</p><p>之后几乎没用过，最近觉得要建自己的博客，而且也应过经常使用markedown写博客，而（稳定的）图床是不得不面临的。</p><p><strong>对本人来说，上传图片的方式最频繁的、最快捷的需求就是直接复制粘贴图片</strong></p><h2 id="图床选择"><a href="#图床选择" class="headerlink" title="图床选择"></a>图床选择</h2><p>基于国内网络环境，本文推荐两个稳定快速的图床：新浪微博、Imgbb。</p><p>一些教程是说到<strong>Typora+ipic+七牛云</strong>的方式；</p><p>不过iPic插件仅支持mac系统，而且我的七牛也没审核通过，所以也没有去倒腾。</p><h1 id="新浪微博图床插件"><a href="#新浪微博图床插件" class="headerlink" title="新浪微博图床插件"></a>新浪微博图床插件</h1><p>这个得益于github大神的开源项目<strong>WeiboPicBed（新浪微博图床 Chrome扩展）</strong></p><p><strong>使用方法：</strong>Chrome浏览器 + 插件</p><p><strong>注意事项：</strong>需要提前在chrome里面登录新浪微博</p><p><strong>插件特点：</strong></p><ul><li>支持<strong>点选/拖拽/本地粘贴</strong>3种方式上传图片至新浪微博图床</li><li>支持批量上传</li><li>可选择返回的图片尺寸（三种尺寸大小）</li><li>可生成图片链接,HTML,UBB和Markdown四种格式</li><li>上传历史浏览和删除.</li><li>支持返回https安全协议的图片地址</li></ul><p>插件的截图如下：</p><p><img src="https://ws1.sinaimg.cn/large/9d89d613ly1g26zo81c6cj20lx0d9mya.jpg" alt></p><h1 id="Imgbb-ibb-图床使用"><a href="#Imgbb-ibb-图床使用" class="headerlink" title="Imgbb(ibb)图床使用"></a>Imgbb(ibb)图床使用</h1><h2 id="imgbb网站特点"><a href="#imgbb网站特点" class="headerlink" title="imgbb网站特点"></a>imgbb网站特点</h2><ul><li>支持中文语言，国内网络可直接访问（美国服务器）</li><li>支持任意<strong>拖放/粘贴</strong>图片到网页里面即可上传图片（最大 16 MB，jpg,png,bmp,gif）</li><li>支持匿名（无登录）上传</li><li>支持API上传</li></ul><h2 id="Java脚本上传"><a href="#Java脚本上传" class="headerlink" title="Java脚本上传"></a>Java脚本上传</h2><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><p>从剪切板中直接复制上传缓存图片到imgbb服务器，返回文本（可粘贴）</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>简单叙述一下流程：</p><ol><li>从剪切板中读取图片缓存</li><li>将图片缓存转base64编码</li><li>API上传图片并返回状态</li><li>将链接文本复制到剪切板</li></ol><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>个人说明：</p><ol><li>对java有些机制不熟悉，很简单的几个功能硬是各种错误，各种尝试，花了一个晚上才完成。如果有什么问题或者更好的方法欢迎直接批评建议。</li><li>本程序是Ubuntu系统，复制文字的方法直接（Ctrl+V）粘贴并不起作用，找了好久的教程发现需要保持个系统进程，其他操作系统并未测试。</li><li>Java的http访问也是很不习惯（不熟悉），尤其是post参数，比如字符串类型，json类型，表单类型等的请求很混乱。Header还容易出问题。</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> oucbl</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2019.04.13</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.awt.Toolkit;</span><br><span class="line"><span class="keyword">import</span> java.awt.datatransfer.Clipboard;</span><br><span class="line"><span class="keyword">import</span> java.awt.datatransfer.DataFlavor;</span><br><span class="line"><span class="keyword">import</span> java.awt.datatransfer.StringSelection;</span><br><span class="line"><span class="keyword">import</span> java.awt.datatransfer.Transferable;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.RenderedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.ByteArrayOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"><span class="keyword">import</span> java.io.UncheckedIOException;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"><span class="keyword">import</span> java.net.URLEncoder;</span><br><span class="line"><span class="keyword">import</span> javax.net.ssl.HttpsURLConnection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.json.simple.JSONObject;</span><br><span class="line"><span class="keyword">import</span> org.json.simple.parser.JSONParser;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClipboardToBase64</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将字符串复制到剪切板（复制）</span></span><br><span class="line"><span class="comment"> * 参考：http://landcareweb.com/questions/18364/fu-zhi-dao-quan-ju-jian-tie-ban-bu-gua-yong-yu-ubuntuzhong-de-java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">setSysClipboardText</span><span class="params">(String text)</span> <span class="keyword">throws</span> IOException</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Clipboard clip = Toolkit.getDefaultToolkit().getSystemClipboard();</span><br><span class="line"></span><br><span class="line">Transferable tText = <span class="keyword">new</span> StringSelection(text);</span><br><span class="line">clip.setContents(tText, <span class="keyword">null</span>);</span><br><span class="line"><span class="comment">// 上两行可有替换成</span></span><br><span class="line"><span class="comment">// StringSelection tText = new StringSelection(text);</span></span><br><span class="line"><span class="comment">// clip.setContents(tText, tText);</span></span><br><span class="line"></span><br><span class="line">System.out.println(<span class="string">"字符串复制成功。"</span>);</span><br><span class="line">System.in.read(); <span class="comment">// 只是让进程保持活动状态</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从剪切板获得图片缓存</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedImage <span class="title">getImageFromClipboard</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">Clipboard sysc = Toolkit.getDefaultToolkit().getSystemClipboard();</span><br><span class="line">Transferable cc = sysc.getContents(<span class="keyword">null</span>);</span><br><span class="line"><span class="keyword">if</span> (cc == <span class="keyword">null</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (cc.isDataFlavorSupported(DataFlavor.imageFlavor))</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> (BufferedImage) cc.getTransferData(DataFlavor.imageFlavor);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将图片缓存转为base64编码</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">imgToBase64String</span><span class="params">(<span class="keyword">final</span> RenderedImage img,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">final</span> String formatName)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">final</span> ByteArrayOutputStream os = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">ImageIO.write(img, formatName, os);</span><br><span class="line"><span class="keyword">return</span> Base64.getEncoder().encodeToString(os.toByteArray());</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="keyword">final</span> IOException ioe)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> UncheckedIOException(ioe);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 参考：https://www.baeldung.com/httpurlconnection-post 通过api上传图片</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> imgbbKey</span></span><br><span class="line"><span class="comment"> *            imgbb上传API的key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> imgb64str</span></span><br><span class="line"><span class="comment"> *            图片的base64编码</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> imgname</span></span><br><span class="line"><span class="comment"> *            待上传图片的命名</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 并返回json响应文本</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">uploadImgbb</span><span class="params">(String imgbbKey, String imgb64str,</span></span></span><br><span class="line"><span class="function"><span class="params">String imgname)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">String httpsURL = <span class="string">"https://api.imgbb.com/1/upload"</span>;</span><br><span class="line">URL myUrl = <span class="keyword">new</span> URL(httpsURL);</span><br><span class="line">HttpsURLConnection con = (HttpsURLConnection) myUrl.openConnection();</span><br><span class="line">con.setRequestMethod(<span class="string">"POST"</span>);</span><br><span class="line">con.setRequestProperty(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/5.0"</span>);</span><br><span class="line">con.setDoOutput(<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">StringBuffer params = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"><span class="comment">// 表单参数与get形式一样</span></span><br><span class="line">params.append(<span class="string">"key"</span>).append(<span class="string">"="</span>).append(imgbbKey).append(<span class="string">"&amp;"</span>)</span><br><span class="line">.append(<span class="string">"image"</span>).append(<span class="string">"="</span>)</span><br><span class="line">.append(URLEncoder.encode(imgb64str)).append(<span class="string">"&amp;"</span>).append(<span class="string">"name"</span>)</span><br><span class="line">.append(<span class="string">"="</span>).append(URLEncoder.encode(imgname));</span><br><span class="line"><span class="keyword">byte</span>[] bypes = params.toString().getBytes();</span><br><span class="line">con.getOutputStream().write(bypes);<span class="comment">// 输入参数</span></span><br><span class="line"></span><br><span class="line">BufferedReader in = <span class="keyword">new</span> BufferedReader(</span><br><span class="line"><span class="keyword">new</span> InputStreamReader(con.getInputStream()));</span><br><span class="line">String inputLine;</span><br><span class="line">StringBuffer response = <span class="keyword">new</span> StringBuffer();</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> ((inputLine = in.readLine()) != <span class="keyword">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">response.append(inputLine);</span><br><span class="line">&#125;</span><br><span class="line">in.close();</span><br><span class="line"></span><br><span class="line">String responseString = response.toString();</span><br><span class="line">System.out.println(responseString);</span><br><span class="line"><span class="keyword">return</span> responseString;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 格式化json文本，并返回所需文本</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getMdtext</span><span class="params">(String imgbbres)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">String mdtext = <span class="keyword">null</span>;</span><br><span class="line"><span class="keyword">try</span></span><br><span class="line">&#123;</span><br><span class="line">JSONParser parser = <span class="keyword">new</span> JSONParser();</span><br><span class="line">Object resultObject = parser.parse(imgbbres);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (resultObject <span class="keyword">instanceof</span> JSONObject)</span><br><span class="line">&#123;</span><br><span class="line">JSONObject obj = (JSONObject) resultObject;</span><br><span class="line"><span class="keyword">if</span> (obj.get(<span class="string">"status"</span>).toString().contains(<span class="string">"200"</span>))</span><br><span class="line">&#123;</span><br><span class="line">JSONObject data = (JSONObject) obj.get(<span class="string">"data"</span>);</span><br><span class="line">mdtext = <span class="string">"![ ]("</span> + data.get(<span class="string">"url"</span>).toString() + <span class="string">")"</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> handle exception</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> mdtext;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">String imgbbKey = <span class="string">"f8418f659962dec949f7271a6287a167"</span>; <span class="comment">// 可修改为自己的key</span></span><br><span class="line"></span><br><span class="line">BufferedImage image = getImageFromClipboard();</span><br><span class="line"><span class="keyword">if</span> (image == <span class="keyword">null</span>)</span><br><span class="line">&#123;</span><br><span class="line">System.out.println(<span class="string">"clipboard image is null"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">String b64str = imgToBase64String(image, <span class="string">"png"</span>);</span><br><span class="line">System.out.println(b64str.length());</span><br><span class="line">String imgbbres = uploadImgbb(imgbbKey, b64str, <span class="string">"imgname"</span>);</span><br><span class="line">String mdtext = getMdtext(imgbbres);</span><br><span class="line"></span><br><span class="line">System.out.println(mdtext);</span><br><span class="line">setSysClipboardText(mdtext);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="期待"><a href="#期待" class="headerlink" title="期待"></a>期待</h3><ol><li>本文java程序只是一个核心上传的控制台程序，如果可以<strong>提供GUI的接口并打成jar包</strong>，甚至可以有预览、编辑等简单实用功能，并不见得不是一个高效的可替代方案。</li><li>Flameshot v0.6.0 是Ubuntu平台很强大的一个C++开源截图软件，自带<strong>上传Imgur</strong>功能，不过看不到具体的配置，而且网络也不通，如果能把这个功能替换或扩展到别的多个<strong>可用平台</strong>，就方便多了。</li></ol><h2 id="相关工具"><a href="#相关工具" class="headerlink" title="相关工具"></a>相关工具</h2><p>新浪微博图床 Chrome扩展（github）</p><p><a href="https://github.com/Suxiaogang/WeiboPicBed" target="_blank" rel="noopener">https://github.com/Suxiaogang/WeiboPicBed</a></p><p>Imgbb官网</p><p><a href="https://imgbb.com/" target="_blank" rel="noopener">https://imgbb.com/</a></p><hr><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>题 复制到全局剪贴板不适用于Ubuntu中的Java</p><p><a href="http://landcareweb.com/questions/18364/fu-zhi-dao-quan-ju-jian-tie-ban-bu-gua-yong-yu-ubuntuzhong-de-java" target="_blank" rel="noopener">http://landcareweb.com/questions/18364/fu-zhi-dao-quan-ju-jian-tie-ban-bu-gua-yong-yu-ubuntuzhong-de-java</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h1 id=&quot;Markdown图床&quot;&gt;&lt;a href=&quot;#Markdown图床&quot; class=&quot;headerlink&quot; title=&quot;Markdown图床&quot;&gt;&lt;/a&gt;Markdown图床&lt;/h1&gt;&lt;h2 id=&quot;图床需求&quot;&gt;&lt;a href=&quot;#图床需求&quot; class=&quot;head
      
    
    </summary>
    
      <category term="学习笔记" scheme="https://oucbl.github.io/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    
    
      <category term="图床" scheme="https://oucbl.github.io/tags/%E5%9B%BE%E5%BA%8A/"/>
    
      <category term="WeiboPicBed" scheme="https://oucbl.github.io/tags/WeiboPicBed/"/>
    
      <category term="Java" scheme="https://oucbl.github.io/tags/Java/"/>
    
  </entry>
  
</feed>
